{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="{% static 'home.css' %}" />
    <title>Password Generator</title>
  </head>

  <body>
    <div class="container text-center" style="padding-top: 2%">
      <h1 id="card-title">Password Generator</h1>
      <form
        action="{% url 'password' %}"
        style="font-size: 2rem; padding-top: 5rem; text-align: left margin-left: 1rem;"
      >
        Length of the password
        <select
          id="length"
          name="length"
          style="width: 15%; font-size: 1.25rem"
        >
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
          <option value="13" selected="selected">13</option>
          <option value="14">14</option>
          <option value="15">15</option>
          <option value="16">16</option>
          <option value="17">17</option>
          <option value="18">18</option>
          <option value="19">19</option>
          <option value="20">20</option>
        </select>
        <br />
        No. passwords to generate
        <select
          id="passcount-select"
          name="passcount"
          style="width: 15%; font-size: 1.25rem"
        >
          <option value="1" selected="selected">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
          <option value="13">13</option>
          <option value="14">14</option>
          <option value="15">15</option>
        </select>
        <br />
        <div class="requirement">
          <input
            id="checkbox"
            type="checkbox"
            style="width: 1.2rem; height: 1.2rem"
            name="uppercase"
          />
          UpperCase
          <br />
          <input
            id="checkbox"
            type="checkbox"
            style="width: 1.2rem; height: 1.2rem"
            name="number"
          />
          Numbers
          <br />
          <input
            id="checkbox"
            type="checkbox"
            style="width: 1.2rem; height: 1.2rem"
            name="special"
          />
          Special Characters <br /><br />
        </div>

        Must Include:
        <input
          type="text"
          style="
            height: 2rem;
            padding: 1.3rem 0.5rem 1.3rem 0.5rem;
            border-radius: 0.6rem;
          "
          name="include"
          id="include"
        />
        <br class="lengthWarning">
        <div class="lengthWarning" style="display:none">Included Characters can't be longer than Length!</div>
        <br /><br />
        <input
          type="submit"
          value="Generate Password"
          class="btn btn-lg btn-primary"
          style="font-weight: bold"
        />
      </form>
    </div>
  </body>

  <script>
    const length = document.getElementById("length");
		const text = document.getElementById("include");
        const warningElements = document.getElementsByClassName("lengthWarning");

		let len = length.value;
		length.addEventListener("change", () => {
			len = length.value;
			if (text.value.length > len) {
				text.value = text.value.substring(0, len);
			}
		})
    
		text.addEventListener("keydown", (e) => {		
			console.log(e.keyCode);
			keycodes = [8, 37, 39, 46];
			if ((text.value.length >= len && !keycodes.includes(e.keyCode)) || e.keyCode == 32) {
				e.preventDefault();
			}
            for (var i = 0; i < warningElements.length; i++) {
                warningElements[i].style.display = "none"
            }
		})

    text.addEventListener("paste", (e) => {
        let clipboardData, pastedDataLength;

        clipboardData = e.clipboardData || window.clipboardData;
        pastedDataLength = clipboardData.getData('Text').length;

        if(pastedDataLength > len){
            e.stopPropagation();
            e.preventDefault();
            for (var i = 0; i < warningElements.length; i++) {
                warningElements[i].style.display = "block"
            }
        }else{
            for (var i = 0; i < warningElements.length; i++) {
                warningElements[i].style.display = "none"
            }
        }
    })
  </script>
</html>
